<!DOCTYPE html>

<head>
  <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
  <script type="text/javascript" src="js/winddata.js"></script>
  <script type="text/javascript" src="js/gamestate.js"></script>
  <script type="text/javascript" src="js/settings.js"></script>
  <script type="text/javascript" src="js/controlls.js"></script>
  <script type="text/javascript" src="js/windeditor.js"></script>
  <script type="text/javascript" src="js/game.js"></script>
  <link type="image/x-icon" rel="icon" href="img/favicon.ico" />
  <title>Pentium-Rinrab</title>
  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <style type="text/css">
    body {
      position: fixed;
      overflow: hidden;
      width: 100%;
      height: 100%;
      touch-action: none;
    }

    body>* {
      position: unset;
    }

    .bi {
      display: inline-block;
      vertical-align: -.125em;
      fill: currentcolor;
    }

    .game-elem {
      position: absolute;
    }

    .pn-lines {
      width: 500%;
      margin-left: -250%;
      transform-origin: center top;
      transition: all 0.5s ease-in-out;
    }

    #wind {
      transition: all 0.5s ease-in-out;
      width: 50px;
      left: 20px;
      transform-origin: center 40%;
      position: fixed;
    }

    #boats>.game-elem {
      transition: top 0.5s ease-in-out, left 0.5s ease-in-out, rotate 0.2s ease-in-out;
    }

    #game-area>* {
      position: absolute;
    }

    .list-group-item {
      height: 35px;
      font-size: 15px;
    }

    .pn-wind-hide,
    .wind-data-arrow {
      position: absolute;
    }

    .wind-data-arrow {
      height: 50px;
      right: 15px;
      margin-top: -10px;
    }

    .pn-wind-hide {
      height: 15px;
      right: 10px;
    }

    .pn-boat {
      --boat-scale: 1.2;
      width: calc(14px * var(--boat-scale));
      height: calc(20px * var(--boat-scale));
      margin-left: calc(-7px * var(--boat-scale));
      margin-top: calc(-10px * var(--boat-scale));
      transform-origin: center;
    }

    .pn-control-color,
    .pn-control-finish-time {
      border-radius: 4px;
      margin: -5px;
      width: 1.5em;
      height: 1.5em;
      color: white;
    }

    .pn-control-finish-time {
      width: 5em;
      color: black;
    }

    .pn-mark {
      width: 20px;
      height: 20px;
      margin-left: -10px;
      margin-top: -10px;
    }

    #btn-add-player {
      width: auto;
    }

    #back-btn {
      width: 25%;
    }

    #btn-done {
      flex: auto;
    }

    #btn-apply {
      flex: auto;
    }

    #lines-img {
      width: 100%;
    }

    #game-area {
      transform-origin: left top;
      overflow: hidden;
      cursor: grab;
    }

    #game-area:active {
      cursor: grabbing;
    }

    #game-area svg {
      display: block;
    }

    #game-cont {
      width: 100%;
      height: 100%;
    }

    #btn-nowember {
      width: 3em;
      height: 2em;
    }

    .pn-start-line {
      width: 20px;
      height: 20px;
      position: absolute;
      margin-top: -10px;
    }

    .wind-data-scroller {
      height: 100vh;
      overflow: auto;
    }

    #lines-container {
      height: 200%;
      width: 200%;
      transform-origin: center;
      margin-top: -50%;
      margin-left: -50%;
      transition: all 0.5s ease-in-out;
    }

    #wind-label {
      left: 50px;
      top: 30px;
      font-family: monospace;
      text-align: right;
      width: 100px;
      position: fixed;
    }

    .start .race-control-header,
    .start .race-controls,
    .start #game-alert,
    .race #start-alert,
    .race #create,
    .race .start-controls,
    .race .start-control-header,
    .race #create,
    .race .start-controls,
    #game-area[data-show-boats="dot"] .boat-full-svg,
    #game-area[data-show-boats="full"] .boat-hidden-svg {
      display: none;
    }

    [data-current-tack="port"] .starboard-forward-btn,
    [data-current-tack="port"] .starboard-tack-btn {
      display: none;
    }

    [data-current-tack="starboard"] .port-forward-btn,
    [data-current-tack="starboard"] .port-tack-btn {
      display: none;
    }

    .icon-sm {
      width: 16px;
      height: 16px;
    }

    .copyright {
      width: 100%;
      bottom: 0px;
      font-size: x-small;
    }

    .finished .race-controls,
    .finished .start-controls {
      display: none;
    }

    .race .finish-controls,
    .start .finish-controls {
      display: none;
    }

    .finished .finish-controls {
      display: flex;
    }
  </style>
</head>

<body class="start">
  <svg xmlns="http://www.w3.org/2000/svg" version="1.1" display="block" height="0">
    <defs>
      <symbol id="icon-starboard-forward" viewBox="0 0 16 16">
        <polyline points="14,14 2,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-width="1.7" />

        <polyline points="3,8 2,2 8,3" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-linecap="round"
          stroke-width="1.7" />

        <ellipse rx="1.8" ry="1.8" cx="14" cy="14" fill="currentColor" />
      </symbol>
      <symbol id="icon-port-forward" viewBox="0 0 16 16">
        <polyline points="2,14 14,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-width="1.7" />

        <polyline points="13,8 14,2 8,3" fill="none" stroke="currentColor" stroke-linejoin="miter"
          stroke-linecap="round" stroke-width="1.7" />

        <ellipse rx="1.8" ry="1.8" cx="2" cy="14" fill="currentColor" />
      </symbol>
      <symbol id="icon-starboard-tack" viewBox="0 0 16 16">
        <polyline points="8,14 2,8 8,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-width="1.7" />

        <polyline points="8,7 9,1 3,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-linecap="round"
          stroke-width="1.7" />
        <ellipse rx="1.8" ry="1.8" cx="8" cy="14" fill="currentColor" />
      </symbol>
      <symbol id="icon-port-tack" viewBox="0 0 16 16">
        <polyline points="8,14 14,8 8,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-width="1.7" />

        <polyline points="8,7 7,1 13,2" fill="none" stroke="currentColor" stroke-linejoin="miter" stroke-linecap="round"
          stroke-width="1.7" />
        <ellipse rx="1.8" ry="1.8" cx="8" cy="14" fill="currentColor" />
      </symbol>
    </defs>
  </svg>
  <div class="row h-100 g-0">
    <div style="width: calc(100vh * 200 / 500); padding: 0;" id="wind-data-container">
      <svg xmlns="http://www.w3.org/2000/svg" id="wind-data-svg" class="h-100"></svg>
    </div>
    <div class="col p-0 position-relative overflow-hidden">
      <div id="game-cont" class="position-absolute">
        <div id="game-area" style="position: relative;  height: 100%; width: 100%;">
          <svg viewBox="0 0 1 1" id="background" style="height: 100%;  background-color: #ebeaff;"></svg>
          <div class="copyright">
            <div class="text-center text-muted">
              PENTIUM &copy; Rautu &amp; Rinrab
            </div>
          </div>
          <div id="lines-container">
            <svg id="lines-svg" stroke="gray" class="w-100 h-100" xmlns="http://www.w3.org/2000/svg"
              stroke-width="0.005">
              <g id="lines-drawing"></g>
            </svg>
          </div>
          <div id="marks"></div>
          <div id="track-cont" style="width:100%; height: 100%;">
            <svg id="track" xmlns="http://www.w3.org/2000/svg" class="game-elem" style="height: 100%;">
            </svg>
          </div>
          <div id="boats"></div>
          <svg xmlns="http://www.w3.org/2000/svg" id="start-line-svg">
            <line id="start-line" stroke-dasharray="4 6" stroke-width="0.5" stroke="gray"></line>
          </svg>
        </div>
      </div>
      <img src="img/wind.svg" id="wind" class="game-elem" />
      <h3 class="game-elem" id="wind-label">+10ยบ</h3>
    </div>
    <div style="width: 300px;" id="controll-container" class="h-100">
      <div class="d-flex flex-column align-items-stretch h-100 p-1">
        <div>
          <div id="start-alert" class="alert alert-warning text-center">
            Start procedure
            <label style="width: 10px;"></label>
          </div>
          <div id="game-alert" class="alert alert-info text-center">
            Race:
            <span id="wind-scenario-name-inrace-alert"></span>
            <label style="width: 10px;"></label>
            <input type="image" class="btn btn-outline-primary btn-sm" id="btn-nowember" src="img/november.svg">
          </div>
        </div>
        <div id="create">
          <div class="input-group mb-3">
            <select id="select-wind" class="form-select"></select>
            <button id="edit-btn" class="btn btn-outline-primary" data-bs-toggle="modal"
              data-bs-target="#wind-editor-window" data-bs-placement="top" data-bs-title="Edit wind">
              &#9998;
            </button>
            <button id="add-wind-btn" class="btn btn-outline-primary" data-bs-toggle="modal"
              data-bs-target="#wind-editor-window" data-bs-placement="top" data-bs-title="Add custom wind">
              +
            </button>
          </div>
        </div>
        <div class="w-100 mb-2 input-group start-control-header">
          <button class="btn btn-outline-danger" id="btn-add-player">+</button>
          <button class="btn btn-outline-primary" id="btn-apply">Start!</button>
        </div>
        <div class="w-100 mb-2 input-group race-control-header">
          <button class="btn btn-outline-primary" id="back-btn">Back</button>
          <button class="btn btn-outline-primary" id="btn-done">Next</button>
        </div>
        <div class="flex-grow-1 flex-shrink-1 mb-2 overflow-auto">
          <div id="controlls" style="width: 100%;">
            <div id="last-controll" class="mb-2"></div>
          </div>
        </div>
        <div class="settings-container">
          <div class="w-100">
            <input type="range" class="form-range" id="scale-range" min="1" max="3" step="0.01">
          </div>
          <div class="btn-group w-100" role="group" aria-label="Settings">
            <input class="btn-check" type="checkbox" id="set-show-tracks" />
            <label class="btn btn-outline-secondary" for="set-show-tracks"
                   title="Show tracks">
               <svg xmlns="http://www.w3.org/2000/svg" style="scale: 1.5;" width="16" height="16" viewBox="0 0 16 16" class="bi">
                <path d="m6.3 15-.5-.4-.5-.4-.5-.4.5-.4.5-.3.6-.3.6-.3.6-.3.6-.3.6-.3.7-.2-.3-.4-.4-.4-.4-.4-.4-.4-.4-.4-.5-.4-.4-.4-.5-.4-.5-.3-.5-.4.5-.4.5-.4.5-.4.6-.3.5-.4.5-.4.4-.4"
                      fill="none" stroke="currentColor" stroke-width="0.5"></path>
                <ellipse rx="0.7" cx="2" cy="15"></ellipse>
                <ellipse rx="0.7" cx="14" cy="15"></ellipse>
                <ellipse rx="0.7" cx="8" cy="2"></ellipse>
              </svg>
            </label>

            <input class="btn-check" type="checkbox" id="set-show-boats" />
            <label class="btn btn-outline-secondary" for="set-show-boats"
                   title="Show boats">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="-5.6247 -10 11.2494 18.5" style="scale: 1.5; rotate: 45deg" class="bi bi-arrows-fullscreen">
                <path d="M -4 7.5 L 4 7.5 C 5 1.5 5 -2.5 2.5 -9 L -2.5 -9 C -5 -2.5 -5 1.5 -4 7.5 Z" stroke="currentColor" stroke-width="1" fill="none" />
                <path d="M 0 -6 C 2 -4 3 -1 2 6" stroke="currentColor" fill="none" stroke-width="1" />
                <ellipse rx="1" ry="1" cx="0" cy="-6" />
              </svg>
            </label>

            <input class="btn-check" type="checkbox" id="set-show-lanelines" />
            <label class="btn btn-outline-secondary" for="set-show-lanelines"
                   title="Show lanelines">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" style="scale: 1.5" viewBox="-8 0 16 16" class="bi">
                <path d="M -8 12 L 0 4 L 8 12" stroke="currentColor" stroke-width=".5" fill="none"></path>
                <ellipse rx="1.5" ry="1.5" cx="0" cy="4" fill="currentColor"></ellipse>
              </svg>      
            </label>

            <input type="checkbox" class="btn-check" id="set-show-equal-lines" />
            <label class="btn btn-outline-secondary show-future-wind"
                   for="set-show-equal-lines"
                   title="Show equal lines">
              <svg viewBox="0 0 16 16" width="16" height="16" xmlns="http://www.w3.org/2000/svg" style="scale: 1.5" class="bi">
                <defs>
                  <path transform="scale(0.3) translate(9, 10) rotate(-15)" id="boat"
                    d="M -4 7.5 L 4 7.5 C 5 1.5 5 -2.5 2.5 -9 L -2.5 -9 C -5 -2.5 -5 1.5 -4 7.5 Z" stroke="currentColor"
                    stroke-width="3" fill="none" />
                </defs>
                <path d="M 0 15 L 16 11 M 0 11 L 16 7 M 0 7 L 16 3 M 0 3 L 16 -1 M 16 15 L 0 19" fill="none" stroke="currentColor"
                  stroke-width="0.5" />
                <use href="#boat" transform="translate(-1, 7) rotate(-45)"></use>
                <use href="#boat" transform="translate(7, 7) rotate(-45)" />
              </svg>      
            </label>

            <input type="checkbox" class="btn-check" id="show-future-wind" />
            <label class="btn btn-outline-secondary show-future-wind"
                   for="show-future-wind"
                   title="Show future wind">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" style="scale: 1.5" width="16" height="16" class="bi">
                <path id="arrow" d="M 3 2 L 3 10 M 7 2 L 7 10 M 1 11 L 5 15 L 9 11" 
                      transform="rotate(-10) translate(-2, 0)" stroke-linecap="round" stroke="currentColor" fill="none" />
                <use href="#arrow" transform="scale(0.5) translate(23, 0) rotate(20)"></use>
              </svg>
            </label>
            <input type="checkbox" class="btn-check" id="full-screen" />
            <label class="btn btn-outline-secondary" for="full-screen"
                   title="Fullscreen mode">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrows-fullscreen" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z" />
              </svg>
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade  modal-lg" id="wind-editor-window" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">Wind Editor</h1>
          <div class="mr-0">
            <button class="btn btn-outline-primary" id="share-btn" data-bs-toggle="tooltip" data-bs-trigger="none"
              data-bs-title="Link copied to clipboard!">
              Share
            </button>
          </div>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning" id="wind-readonly-text">
            This is predifined wind preset. It cannot be changed. Use 'Create Wind' button to
            create custom wind scenario.
          </div>
          <div class="mb-3">
            <label class="form-label">Scenario name</label>
            <input type="text" class="form-control" id="editor-wind-name" placeholder="i.e. &#34;pendulum 1&#34" />
          </div>
          <div class="mb-0">
            <label class="form-label">Wind change</label>
            <textarea class="form-control" id="editor-wind" rows="7" placeholder="i.e. 5, 10, 15, 20, 15...">
            </textarea>
          </div>
          <div class="mb-3">
            <div class="invalid-feedback" id="wind-valid"></div>
          </div>
          <div class="mb-3">
            <div class="row">
              <div class="col">
                <label class="form-label">Map width</label>
                <input type="number" value="40" min="5" max="200" class="form-control" id="map-width" />
              </div>
              <div class="col">
                <label class="form-label">Map height</label>
                <input type="number" value="30" min="5" max="200" class="form-control" id="map-height" />
              </div>
              <div class="col">
                <label class="form-label">Start line size</label>
                <input type="number" value="15" min="5" max="200" class="form-control" id="start-line-size" />
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="editor-save" data-bs-dismiss="modal">
            Save changes
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" style="position: absolute; left: 10px;" id="delete-btn"
            data-bs-dismiss="modal">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade modal-lg" id="add-wind-url-window">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5">Add wind?</h1>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Scenario name</label>
            <input type="text" class="form-control" id="add-wind-name" readonly />
          </div>
          <div class="mb-0">
            <label class="form-label">Wind change</label>
            <textarea class="form-control" id="add-wind-text" rows="7" readonly></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="load-wind-save" data-bs-dismiss="modal">
            Add wind
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal modal fade" id="help-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Help</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row">
            <table class="table table-borderless">
              <tbody>
                <tr>
                  <th class="text-center" colspan="1">Keyboard shortcuts</th>
                </tr>
                <tr>
                  <td class="text-end"><kbd>Space</kbd></th>
                  <td>Next turn</td>
                </tr>
                <tr>
                  <td class="text-end"><kbd>Backspace</kbd></th>
                  <td>Previous turn</td>
                </tr>
                <tr>
                  <td class="text-end"><kbd>1</kbd> - <kbd>9</kbd></th>
                  <td>Change player turn selection</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  <button type="button" class="btn btn-primary" id="liveToastBtn">Show live toast</button>

  <div class="toast-container position-fixed top-0 start-0 p-3">
    <div id="too-many-boats-alert" class="toast" data-bs-autohide="true" data-bs-delay="4000">
      <div class="toast-header">
        <strong class="me-auto">Too many boats</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        You can't add more players.
      </div>
    </div>
  </div>
</body>